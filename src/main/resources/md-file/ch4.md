# 스트림
- - -
## 스트림이란?
자바 8 API에 추가된 기능으로 컬렉션 데이터를 처리할 수 있으며, 멀티스레드 코드를 구현하지 않아도 데이터를 투명하게 병렬로 처리할 수 있다.
- filter, sorted, map, collect 같은 연산은 고수준 빌딩 블록으로 이루어져 있으므로 특정 스레딩 모델에 제한되지 않고 자유롭게 어떤 상황에서든 사용할 수 있다.
    - 스레드와 락을 걱정할 필요가 없다.

스트림 장점
- 선언형
    - 더 간겨하고 가독성이 좋아짐
- 조립할 수 있음
    - 유연성이 좋아짐
- 병렬화
    - 성능이 좋아짐

## 스트림 시작하기
데이터 처리 연산을 지원하도록 소스에서 추출된 연속된 요소라 정의할 수 있는 스트림을 살펴보자
1. 연속된 요소
    - 컬렉션과 마찬가지로 특정 요소 형식으로 이루어진 연속된 값 집합의 인터페이스를 제공
2. 소스
    - 리스트로 스트림을 만들면 스트림의 요소는 리스트의 요소와 같은 순서를 유지한다.
3. 데이터 처리 연산
    - 함수형 프로그래밍 언어에서 지원하는 연산과 데이터베이스와 비슷한 연산을 지원한다.
      - ex)filter, map, reduce, find, match, sort...
4. 파이프라이닝
    - 스트림 연산은 연산끼리 연결해서 커다란 파이프 라인을 구성할 수 있도록 자신을 반환한다. 그덕에 게으름, 쇼트서킷 같은 최적화도 얻을 수 있다.
5. 내부반복
      - 내부반복 지원

## 스트림과 컬렉션
데이터를 언제 계산하느냐가 스트림과 컬렉션의 가장 큰 차이이다.
1. 컬렉션
    - 컬렉션은 현재 자료구조가 포함하는 모든 값을 메모리에 저장한다.
2. 스트림
    - 스트림은 요청할 때만 요소를 계손하는 고정된 자료구조 이다.
    - 또한 스트림은 한번만 탐색할 수 있어 소모 시 새로운 스트림을 만들어 사용해야 한다.
      - 재소비 시 IllegalStateException 발생함

## 스트림 연산
1. 중간 연산
    - 연결할 수 있는 스트림 연산
2. 최종 연산
    - 스트림을 닫는 연산
~~~
@Test
void 쇼트서킷() {
    List<Integer> cals = menu.stream().filter(d -> {
        System.out.println(d.isVegetarian());
        return d.isVegetarian() == false;
    }).map(d -> {
        System.out.println(d.getCalories());
        return d.getCalories();
    })
    .limit(2)
    .collect(Collectors.toList());
    System.out.println(cals);
}
~~~
1. 쇼트서킷
    - 스트림 특성 쇼트서킷 덕분에 filter로 수가지가 걸러지더라도 아래 limit(2) 덕분에 2개만 filtering이 이루어진다.
2. 루프 퓨전
    - filter, map은 서로 다른 연산이지만 루프 퓨전 덕분에 한 과정으로 병합됬다.

### 스트림 이용과정
1. 질의를 수행할 데이터 소스
2. 스트림 파이프라인을 구성할 중간 연산
3. 스트림 파이프라인을 실행하고 결과를 만들 최종 연산

## 정리
- - -
1. 스트림은 소스에서 추출된 연속 요소로, 데이터 처리 연산을 지원하며, 내부 반복 또한 지원한다.
2. 스트림의 요소는 요청할 때 게으르게 계산된다.